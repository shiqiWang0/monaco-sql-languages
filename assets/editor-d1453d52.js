var E=Object.defineProperty;var G=(h,t,e)=>t in h?E(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var C=(h,t,e)=>(G(h,typeof t!="symbol"?t+"":t,e),e);import{B as m,E as O,s as r,x as o,y as f,z as x,F as M,i as D}from"./index-3dac6dbc.js";import{i as g}from"./isUndefined-aa0326a0.js";var _=Object.defineProperty,S=Object.getOwnPropertyDescriptor,j=(h,t,e,s)=>{for(var i=s>1?void 0:s?S(t,e):t,n=h.length-1,u;n>=0;n--)(u=h[n])&&(i=(s?u(t,e,i):u(i))||i);return s&&i&&_(t,e,i),i};let v=class extends m{constructor(){super("editor");C(this,"state");this.state=new O}getToolbars(){return this.getState().toolbar}getCurrent(){return this.getState().current}getGroups(){return this.getState().groups}getToolbar(t){return this.getToolbars().find(r(t))}getGroup(t){if(!g(t))return this.getGroups().find(r(t))}getCurrentGroup(){return this.getGroup(this.getCurrent())}getTabs(t){var e;return((e=this.getGroup(t))==null?void 0:e.data)||[]}getCurrentTabs(){return this.getTabs(this.getCurrent())}getTab(t,e){if(!(g(e)||g(t)))return this.getTabs(e).find(r(t))}getCurrentTab(){var t;return this.getTab((t=this.getCurrentGroup())==null?void 0:t.activeTab,this.getCurrent())}getOptions(){return this.getState().options}updateOptions(t){this.dispatch(e=>{Object.assign(e.options,t)})}setOptions(t){this.dispatch(e=>{e.options=t})}setEntry(t){this.dispatch(e=>{e.entry=t})}updateTab(t,e){this.dispatch(s=>{var n;const i=(n=s.groups.find(r(e)))==null?void 0:n.data.find(r(t.id));i&&(Object.assign(i,t),Object.hasOwn(t,"value")&&(Array.isArray(t.value)?i.diffEditorModel&&(i.diffEditorModel.original.getValue()!==t.value[0]&&i.diffEditorModel.original.setValue(t.value[0]??""),i.diffEditorModel.modified.getValue()!==t.value[1]&&i.diffEditorModel.modified.setValue(t.value[1]??"")):i.model&&i.model.getValue()!==t.value&&i.model.setValue(t.value??"")),this.emit(o.onUpdateTab,t.id,e))})}saveTabs(t,e){t.forEach(s=>{this.updateTab({id:s,modified:!1},e)})}addToolbars(t){this.dispatch(e=>{e.toolbar.push(...t)})}updateToolbar(t){this.dispatch(e=>{const s=e.toolbar.find(r(t.id));s&&Object.assign(s,t)})}_close(t){this.dispatch(e=>{var u,l;const s={tabId:(u=this.getCurrentGroup())==null?void 0:u.activeTab,groupId:e.current},i=[];t.forEach(({tabId:a,groupId:d})=>{var T;const b=e.groups.findIndex(r(d)),c=e.groups[b],p=c.data.findIndex(r(a));if(p===-1)return;c.activeTab===a&&(c.activeTab=(T=f(c.data,p))==null?void 0:T.id);const[I]=c.data.splice(p,1);i.push(I)}),t.forEach(({groupId:a})=>{var c,p;const d=e.groups.findIndex(r(a));if(d===-1||e.groups[d].data.length)return;e.current===a&&(e.current=(c=f(e.groups,d))==null?void 0:c.id);const[b]=e.groups.splice(d,1);(p=b.editorInstance)==null||p.dispose()}),i.forEach(a=>{!a.model||e.groups.find(d=>d.data.find(b=>b.model===a.model))||a.model.dispose()}),this.emit(o.onClose,i);const n=(l=e.groups.find(r(e.current)))==null?void 0:l.activeTab;(e.current!==s.groupId||n!==s.tabId)&&this.emit(o.onCurrentChange,s,{tabId:n,groupId:e.current})})}closeTab(t,e){this._close([{tabId:t,groupId:e}])}closeOther(t,e){const i=this.getTabs(e).filter(n=>n.id!==t);this._close(i.map(n=>({tabId:n.id,groupId:e})))}closeToRight(t,e){const s=this.getTabs(e),i=s.slice(s.findIndex(r(t))+1);this._close(i.map(n=>({tabId:n.id,groupId:e})))}closeToLeft(t,e){const s=this.getTabs(e),i=s.slice(0,s.findIndex(r(t)));this._close(i.map(n=>({tabId:n.id,groupId:e})))}closeSaved(t){const s=this.getTabs(t).filter(i=>!i.modified);this._close(s.map(i=>({tabId:i.id,groupId:t})))}removeGroup(t){const e=this.getGroup(t);e&&this._close(e.data.map(s=>({tabId:s.id,groupId:t})))}closeAll(t){if(g(t)){const e=this.getGroups();this._close(e.reduce((s,i)=>(s.push(...i.data.map(n=>({tabId:n.id,groupId:i.id}))),s),[]))}else this.removeGroup(t)}moveTab(t,e){this.dispatch(s=>{var b;const i=s.groups.find(r(t.groupId)),n=s.groups.find(r(e.groupId));if(!i||!n)return;const u=i.data.findIndex(r(t.tabId)),l=n.data.findIndex(r(e.tabId));if(u===-1||l===-1)return;t.groupId!==e.groupId&&i.activeTab===t.tabId&&(i.activeTab=(b=f(i.data,u))==null?void 0:b.id);const a=i.data.splice(u,1),d=n.data.findIndex(r(t.tabId));if(d===-1?n.data.splice(l,0,a[0]):n.data.splice(l,0,n.data.splice(d,1)[0]),n.activeTab=t.tabId,!i.data.length){const c=s.groups.findIndex(r(t.groupId));s.groups.splice(c,1)}})}setCurrentGroup(t){var s;const e=this.getCurrentGroup();this.emit(o.onCurrentChange,{tabId:e==null?void 0:e.activeTab,groupId:e==null?void 0:e.id},{tabId:(s=this.getGroup(t))==null?void 0:s.activeTab,groupId:t}),this.dispatch(i=>{i.current=t})}setCurrent(t,e){const s=this.getCurrentGroup();this.emit(o.onCurrentChange,{tabId:s==null?void 0:s.activeTab,groupId:s==null?void 0:s.id},{tabId:t,groupId:e}),this.dispatch(i=>{i.current=e;const n=i.groups.find(r(e));n&&(n.activeTab=t)})}updateGroup(t){if(Object.hasOwn(t,"activeTab")){const e=this.getCurrentGroup();this.emit(o.onCurrentChange,{tabId:e==null?void 0:e.activeTab,groupId:e==null?void 0:e.id},{tabId:t.activeTab,groupId:t.id})}this.dispatch(e=>{const s=e.groups.find(r(t.id));s&&Object.assign(s,t)})}setLoading(t){this.dispatch(e=>{e.loading=typeof t=="function"?t(e.loading):t})}createGroup(t){return{...new x(`EDITOR_GROUP_${M()}`,[t],t.id)}}addGroup(t){this.dispatch(e=>{e.groups.push(this.createGroup(t))})}addTab(t,e){this.dispatch(s=>{const i=s.groups.find(r(e));i&&i.data.push(t)})}open(t,e){if(this.getGroup(e))this.addTab(t,e),this.setCurrent(t.id,e);else{this.addGroup(t);const s=this.getGroups().at(-1);s&&this.setCurrentGroup(s.id)}this.emit(o.onOpenTab,t)}onFocus(t){this.subscribe(o.onFocus,t)}onCursorSelection(t){this.subscribe(o.onCursorSelection,t)}onSelectTab(t){this.subscribe(o.onSelectTab,t)}onContextMenu(t){this.subscribe(o.onContextMenu,t)}onToolbarClick(t){this.subscribe(o.onToolbarClick,t)}onUpdateTab(t){this.subscribe(o.onUpdateTab,t)}onOpenTab(t){this.subscribe(o.onOpenTab,t)}onChange(t){this.subscribe(o.onChange,t)}onDragStart(t){this.subscribe(o.onDragStart,t)}onDragEnd(t){this.subscribe(o.onDragEnd,t)}onDragEnter(t){this.subscribe(o.onDragEnter,t)}onDragLeave(t){this.subscribe(o.onDragLeave,t)}onDragOver(t){this.subscribe(o.onDragOver,t)}onDrop(t){this.subscribe(o.onDrop,t)}onClose(t){this.subscribe(o.onClose,t)}onCloseAll(t){this.subscribe(o.onCloseAll,t)}onCloseTab(t){this.subscribe(o.onCloseTab,t)}onCloseOther(t){this.subscribe(o.onCloseOther,t)}onCloseToLeft(t){this.subscribe(o.onCloseToLeft,t)}onCloseToRight(t){this.subscribe(o.onCloseToRight,t)}onSplitEditorRight(t){this.subscribe(o.onSplitEditorRight,t)}onContextMenuClick(t){this.subscribe(o.onContextMenuClick,t)}onMount(t){this.subscribe(o.onMount,t)}onModelMount(t){this.subscribe(o.onModelMount,t)}onDiffEditorMount(t){this.subscribe(o.onDiffEditorMount,t)}onDiffEditorModelMount(t){this.subscribe(o.onDiffEditorModelMount,t)}onCurrentChange(t){this.subscribe(o.onCurrentChange,t)}};v=j([D()],v);export{v as EditorService};
